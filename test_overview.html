<!DOCTYPE html>
<html>
<head>
    <title>Estimator Overview Test</title>
    <style>
        .estimator-box {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 12px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        .estimator-box:hover {
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            border-color: #0066cc;
        }
        .estimator-name {
            font-weight: bold;
            font-size: 1.05em;
            color: #0066cc;
            margin-bottom: 6px;
        }
        .estimator-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 6px;
        }
        .estimator-module {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 2px;
        }
        .tag {
            display: inline-block;
            background-color: #e8f4f8;
            border: 1px solid #b3dbe0;
            padding: 3px 8px;
            margin: 2px 4px 2px 0;
            border-radius: 3px;
            font-size: 0.85em;
            color: #333;
        }
        .tag-label {
            font-weight: 500;
            color: #0066cc;
        }
        .tag-value {
            color: #555;
        }
        .estimator-tags {
            margin-top: 8px;
            line-height: 1.6;
        }
        .no-results {
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            color: #666;
        }
        .filters-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .filter-group {
            margin-bottom: 12px;
        }
        .filter-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
            color: #333;
        }
        .filter-group input,
        .filter-group select {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 0.95em;
        }
        .filter-group input[type="text"] {
            width: 100%;
            max-width: 400px;
        }
        .filter-group select[multiple] {
            width: 100%;
            max-width: 500px;
            height: 120px;
        }
        .filter-hint {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }
        .estimator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="estimator-overview-container" style="margin-top: 20px;">
        <div class="filters-section">
            <div class="filter-group">
                <label for="estimator-type-select">
                    Filter by Estimator Type:
                </label>
                <select id="estimator-type-select">
                    <option value="">All Types</option>
                    <option value="regressor_proba">Probabilistic Regressor</option>
                    <option value="distribution">Distribution</option>
                    <option value="metric">Metric</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="search-input">
                    Search Estimators:
                </label>
                <input type="text" id="search-input" placeholder="Type to search by name or module...">
                <div class="filter-hint">Searches estimator name and module path</div>
            </div>

            <div class="filter-group">
                <label for="tags-select">
                    Filter by Tags:
                </label>
                <select id="tags-select" multiple>
                </select>
                <div class="filter-hint">Hold Ctrl (Cmd on Mac) to select multiple tags</div>
            </div>
        </div>

        <div id="estimator-grid" class="estimator-grid">
        </div>

        <div id="no-results" class="no-results" style="display: none;">
            <p><strong>No estimators match the current filters.</strong></p>
        </div>
    </div>

    <script>
        // Mock data for testing
        const estimatorData = [
            {
                "name": "AFTFrisk",
                "object_type": "regressor_proba",
                "module": "unknown",
                "tags": {
                    "object_type": "regressor_proba",
                    "capability:survival": true
                }
            },
            {
                "name": "Ridge",
                "object_type": "regressor_proba",
                "module": "skpro.regression.linear",
                "tags": {
                    "object_type": "regressor_proba",
                    "handles_missing_data": false,
                    "unsupervised": false
                }
            },
            {
                "name": "Normal",
                "object_type": "distribution",
                "module": "skpro.distributions",
                "tags": {
                    "object_type": "distribution",
                    "supervised": false
                }
            },
            {
                "name": "Lasso",
                "object_type": "regressor_proba",
                "module": "skpro.regression.linear",
                "tags": {
                    "object_type": "regressor_proba",
                    "supervised": true,
                    "handles_multioutput": true
                }
            }
        ];

        function formatTagValue(value) {
            if (typeof value === 'boolean') {
                return value ? 'True' : 'False';
            }
            return String(value);
        }

        function renderEstimators() {
            const typeFilter = document.getElementById('estimator-type-select').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const selectedTags = Array.from(document.getElementById('tags-select').selectedOptions).map(o => o.value);

            let filtered = estimatorData.filter(est => {
                // Type filter
                if (typeFilter && est.object_type !== typeFilter) return false;

                // Search filter
                if (searchTerm && !est.name.toLowerCase().includes(searchTerm) &&
                    !est.module.toLowerCase().includes(searchTerm)) return false;

                // Tags filter:
                // - boolean tags: require est.tags[key] === true
                // - string tags: allow key=value syntax and require equality
                if (selectedTags.length > 0) {
                    return selectedTags.every(tagOpt => {
                        if (tagOpt.includes('=')) {
                            const [k, v] = tagOpt.split('=', 2);
                            return (est.tags[k] || '') === v;
                        } else {
                            return est.tags[tagOpt] === true;
                        }
                    });
                }

                return true;
            });

            const grid = document.getElementById('estimator-grid');
            const noResults = document.getElementById('no-results');

            if (filtered.length === 0) {
                grid.innerHTML = '';
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
                grid.innerHTML = filtered.map(est => {
                    const tagsHtml = Object.entries(est.tags)
                        .filter(([key, value]) => value === true || (typeof value === 'string' && value))
                        .map(([key, value]) => `
                            <span class="tag">
                                <span class="tag-label">${key}:</span>
                                <span class="tag-value">${formatTagValue(value)}</span>
                            </span>
                        `)
                        .join('');

                    return `
                        <div class="estimator-box">
                            <div class="estimator-name">${est.name}</div>
                            <div class="estimator-info">
                                <strong>Type:</strong> ${est.object_type}
                            </div>
                            <div class="estimator-info">
                                <strong>Module:</strong> <span class="estimator-module">${est.module}</span>
                            </div>
                            <div class="estimator-tags">
                                ${tagsHtml}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function initializeTags() {
            const tagsSelect = document.getElementById('tags-select');
            const booleanTags = new Set();
            const stringTagValues = new Map(); // key -> Set of values

            estimatorData.forEach(est => {
                Object.entries(est.tags).forEach(([key, value]) => {
                    if (typeof value === 'boolean') {
                        booleanTags.add(key);
                    } else if (typeof value === 'string' && value) {
                        if (!stringTagValues.has(key)) stringTagValues.set(key, new Set());
                        stringTagValues.get(key).add(value);
                    }
                });
            });

            // Add boolean tags (filter means tag is True)
            Array.from(booleanTags).sort().forEach(tag => {
                const option = document.createElement('option');
                option.value = tag;
                option.textContent = tag;
                tagsSelect.appendChild(option);
            });

            // Add string-valued tag options as key=value pairs
            Array.from(stringTagValues.keys()).sort().forEach(tag => {
                const values = Array.from(stringTagValues.get(tag)).sort();
                values.forEach(val => {
                    const option = document.createElement('option');
                    option.value = `${tag}=${val}`;
                    option.textContent = `${tag}=${val}`;
                    tagsSelect.appendChild(option);
                });
            });
        }

        // Event listeners
        document.getElementById('estimator-type-select').addEventListener('change', renderEstimators);
        document.getElementById('search-input').addEventListener('input', renderEstimators);
        document.getElementById('tags-select').addEventListener('change', renderEstimators);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (estimatorData.length > 0) {
                initializeTags();
                renderEstimators();
            }
        });
    </script>
</body>
</html>
